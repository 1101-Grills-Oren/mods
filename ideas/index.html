<!DOCTYPE html>
<html>
  <head>
    <script>
      octokit=0
    </script>
    <script type="module">
      import { Octokit } from "https://esm.sh/@octokit/core";
      octokit = new Octokit({ auth: 'github_p'+'at_11BADMTJI0dmSDa8V5xAJ3_9wUUK5VYsAq'+'jNY6nndJ5rDlTVwuLIYFGGVHzvWEGAQwHFQOVRMDH7yB9C86' });
      document.onOctokitInitialized()
    </script>
    
    <title>
      Ideas
    </title>
  </head>
  <body>
    <div id="ideaslist" style="display:flex;flex-direction: column;flex-grow: 1;"></div>
    <script>
      document.onOctokitInitialized=()=>{
        
        function getContents(path){
        return octokit.request('GET /repos/{owner}/{repo}/contents/{path}', {
          owner: '1101-grills-oren',
          repo: 'mods',
          path: path,
          headers: {
            'X-GitHub-Api-Version': '2022-11-28'
          }
        })
      }
      function setContents(path,contents,sha=null){
        if(sha!=null){
        return octokit.request('PUT /repos/{owner}/{repo}/contents/{path}', {
          owner: '1101-grills-oren',
          repo: 'mods',
          path: path,
          message: 'Updated By Tool',
          content: contents,
          sha:sha,
          headers: {
            'X-GitHub-Api-Version': '2022-11-28'
          }
        })
        }else{
        return octokit.request('PUT /repos/{owner}/{repo}/contents/{path}', {
          owner: '1101-grills-oren',
          repo: 'mods',
          path: path,
          message: 'Updated By Tool',
          content: contents,
          headers: {
            'X-GitHub-Api-Version': '2022-11-28'
          }
        })
        }
      }
      function updateContentsJsonAppendList(path,value,listname){
        getContents(path).then(contents=>{
          content=JSON.parse(atob(contents.data.content))
          content['listname'].push(value)
          setContents(path,btoa(JSON.stringify()),contents.sha)
        })
      }
      function getDocCookie(){
        c=document.cookie.split('; ')
        d={}
        for(i=0;i<c.length;c++){
          d[c[i].split('=')[0]]=c[i].split('=').slice(1).join('=')
        }
        return d
      }
      function setDocCookie(values){
        d=values
        c=[]
        for(i=0;i<c.length;c++){
          c.push(d[i].join('='))
        }
        c.join('; ')
      }
      votes={}
      /*x=getDocCookie()
      if(x['votes']==''){
        
        onclick=function(x){
            if(x.srcElement.dataset['mode']==0){
                x.srcElement.dataset['mode']=1
                x.srcElement.textContent="a"
            }else{
                x.srcElement.dataset['mode']=0
                x.srcElement.textContent="b"
            }
        }
      }*/
      ideaslist=document.querySelector("#ideaslist");
      getContents("data/newIdeas.json").then((contents)=>{
        newhtml=""
        contents=JSON.parse(atob(contents.data.content))
        ideas=contents.ideas
        ideas.push([0,368364,"test",'test description'])
        ideas=ideas.sort((a,b)=>{if(a[0]<b[0]){return -1}else if(a[0]>b[0]){return 1}else{return 0}})
        for(i=0;i<contents.ideas.length;i++){
          newhtml+="<div class='clicktogglechildren' data-child=1><div>"+contents.ideas[i][2]+"</div><div style='display:none;'>"+contents.ideas[i][3]+"</div></div>"
        }
        if(newhtml==""){
          newhtml="Sorry, nothing here at the moment."
        }
        ideaslist.innerHTML=newhtml;

        clicktoggle=document.getElementsByClassName('clicktogglechildren')
        for(i=0;i<clicktoggle.length;i++){
          
          clicktoggle[i].onclick=function(x){
              console.log(x.srcElement.parentElement)
              if(x.srcElement.parentElement.dataset['mode']==1){
                  x.srcElement.parentElement.dataset['mode']=0
                  x.srcElement.parentElement.children[x.srcElement.parentElement.dataset['child']].style.display='none'
              }else{
                  x.srcElement.parentElement.dataset['mode']=1
                  x.srcElement.parentElement.children[x.srcElement.parentElement.dataset['child']].style.display='block'
              }
          }
        }
        
      })
      }
       //each entry is of the form [votes,id,title,description]
    </script>
      <span>Title</span>
      <div contenteditable="true" id="title" style="border-style: solid; border-color: rgb(153, 153, 153);">
        
      </div>
      <span>Description</span>
      <div contenteditable="true" id="description" style="border-style: solid; border-color: rgb(153, 153, 153);">
        
      </div>
    <script>
      let randomInt = Math.floor(Math.random() * 4294967296);
      randomInt
    </script>
  </body>
</html>
